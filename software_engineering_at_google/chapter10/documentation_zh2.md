### 文档格式

工程师编写各种不同类型的文档作为他们工作的一部分:设计文档、代码注释、操作文档、项目页面等等。这些都可以算作“文档”。但重要的是要了解不同的类型，并进行区分。一般来说，一个文件应该只有一个目的，并坚持这个目的。就像API应该只做一件事，并把它做好。避免尝试在一个文档中做几件事。此外，你应该更有逻辑地拆分这些部分。软件工程师经常需要编写的文档主要有以下几种:

•参考文档，包括代码注释

•设计文档

•教程

•概念性文档

•登陆页面

在谷歌的早期阶段，团队通常会拥有包含大量链接(许多已经破损或过时)、关于系统如何工作的概念信息、API参考等等的整体wiki页面。这样的文件之所以失败，是因为它们没有单一的目的(而且它们的篇幅太长，没有人会读它们;一些臭名昭著的维基页面过于长篇冗余)。因此，要确保您的文档具有单一的目的，如果向该页面添加内容是没有意义的，您可能需要寻找甚至创建另一个文档来实现。


#### 参考文档

参考文档是工程师需要编写的最常见的文档类型;事实上，他们经常需要每天写一些参考文档。所谓参考文档，我们指的是在代码库中记录代码使用的任何东西。代码注释是工程师必须维护的最常见的参考文档形式。这种注释可以分为两个基本阵营:API注释和实现注释。请记住这两者之间的受众差异:API注释不需要讨论实现细节或设计决策，不需要用户和作者一样精通API。另一方面，实现注释可以假定读者有更多的领域知识，但这种假定要适当。抛开项目，有时更安全的方法是系统地说明为什么要这样编写代码。

大多数参考文档，即使作为独立于代码的文档提供，也是从代码库本身的注释中生成的，就像参考文档应该尽可能单一来源一样。一些语言，如Java或Python，有特定的注释框架(Javadoc, PyDoc, GoDoc)，旨在使参考文档的生成更容易。其他的局域网语言，如c++，没有标准的“参考文档”实现，因为c++将它的API接口(在头文件或.h文件中)与实现(.cc文件)分开，头文件通常是一个很自然的地方来记录一个c++ API。

谷歌采用了这种方法:一个c++ API应该在头文件中有它的参考文档。其他参考文档也直接嵌入到Java、Python和Go源代码中。因为谷歌的代码搜索浏览器(见第17章)十分健壮，我们发现提供单独的生成参考文档并没有什么好处。代码搜索的用户不仅可以轻松地搜索代码，他们通常可以在顶部的结果中找到代码的原始定义。在代码定义旁边加上说明文档也使文档更容易发现和维护。

我们都知道代码注释对于一个良好文档化的API是必不可少的。但什么才是“好”评论呢?在本章的早些时候，我们为参考文档确定了两个主要的系统:搜索器和阻扰器。搜索器知道他们想要什么;而阻扰器知道不要什么。对于搜索器来说，关键是得到一个一致的注释代码库，这样他们就可以快速扫描一个API并找到他们想要的东西。对于阻扰器来说，关键在于清楚地确定API的用途，通常是在文件头的顶部。我们将在接下来的小节中介绍一些代码注释。下面的代码注释指导原则适用于c++，但是类似的规则也适用于其他语言的谷歌。



#### 文档注释

谷歌中几乎所有代码文件都必须包含文件注释。(有些头文件只包含一个实用函数等，可能会偏离这个标准。)文件注释应该以下列形式开头:

// -----------------------------------------------------------------------------

// str_cat.h 

// ----------------------------------------------------------------------------- 

// 这个头文件包含有效连接和附加字符串的函数:StrCat()和StrAppend()。这些例程中的大部分工作实际上是通过使用特殊的AlphaNum类型来处理的，这种类型被设计为用于参数类型，有效地管理到字符串的转换，并避免上述操作中的复制。

… 

通常，文件注释应该以您正在阅读的代码中包含的内容的大纲开始。它应该识别代码的主要用例和意图(在前面的例子中，开发者想要连接字符串)。任何不能在第一段或第二段中简洁描述的API，通常表明该API没有经过深思熟虑。在这些情况下，可以考虑将API分解成独立的组件。



#### 类注释

大多数现代编程语言都是面向对象的。类注释对于定义代码库中使用的API“对象”非常重要。谷歌的所有公共类(和结构)必须包含一个类注释，描述类/结构、该类的重要方法和该类的用途。一般来说，类评论应该用强调其对象方面的文档“命名”。也就是说，“Foo类包含x、y、z，允许您执行Bar，并具有以下Baz方面”等等。

类注释通常应该以以下形式的注释开始:

// -----------------------------------------------------------------------------

/ / AlphaNum

// -----------------------------------------------------------------------------

//

// AlphaNum类作为StrCat()和StrCat()的主要参数类型

// StrAppend()，提供数字、布尔值和

//十六进制值(通过Hex类型)到字符串。



#### 函数注释

在谷歌，所有的自由函数或类的公共方法也必须包含一个函数注释来描述函数的功能。函数注释应该强调其使用的有效性质，以陈述性动词开头，描述函数做什么以及返回什么。

函数注释通常应该以以下形式的注释开始:

/ / StrCat ()

//

//合并给定的字符串或数字，不使用分隔符，

//以字符串形式返回合并结果。

…

注意，用声明性动词开始函数注释会在使整个头文件中一致性较强。阅读者可以通过快速扫描API，且只需要查看动词，就可以了解该函数是否合适“合并、删除、创建”等等。

一些文档样式(和一些文档生成器)需要各种形式的函数注释模板，如" Returns: "， " Throws: "，等等，但在谷歌中，我们发现它们并不是必要的。用一些散列的评论来表达这些信息通常会更清晰，而不是人为僵硬的定义分界点:

//为给定名称和地址的客户创建一条新记录，

//并返回记录ID，或抛出' DuplicateEntryError '

//记录已经存在。

int AddCustomer(string name, string address);

注意后置条件、参数、返回值和异常情况是如何自然地一起记录的(在本例中，在一个句子中)，因为它们不是相互独立的。添加显式的样板会使注释更加冗长和重复，但不会更加清晰，甚至可能会更不清晰。



#### 教程

每个软件工程师，当他们加入一个新的团队时，都会想要尽快跟上进度。拥有一份指导创建新项目的教程是非常有价值的；此外，“Hello World”已经拥有了自己的地位，这是确保所有团队成员都能以正确的方式开始的最好方法之一。这适用于文档和代码。大多数项目都应该有一个“Hello World”文档，它不需要任何假设，让工程师“真实”地完成一些事情。

通常情况下，编写教程(如果还不存在教程)的最佳时机是当你刚加入一个团队时，这也是在现有教程中寻找漏洞的最佳时机。你可以用用记事本或其他方法做笔记，假设没有领域知识或特殊设置限制，记录下在项目中需要做的所有事情；完成之后，你可能会知道自己在这个过程中犯了什么错误以及为什么犯错，然后可以进一步编辑你的步骤，得到一个更精简的教程。重要的是，写下需要做的所有事情；尽量不要假定任何特定的设置、权限或领域知识。如果您确实需要进行其他设置，请在本教程的开头清楚地说明这一点，作为先决条件。

大多数教程要求您按顺序执行许多步骤。在这些情况下，明确地为这些步骤编号。如果教程的重点是用户(比如外部开发者文档)，那么给用户需要采取的每个行动编号。不要对系统响应这些用户操作可能采取的操作进行编号。在执行此操作时，明确地为每一步编号是至关重要的。没有什么比第4步出错更烦人的了，比如，你忘记告诉别人授权他们的用户名。

例子:糟糕的教程

1. 从我们的服务器http://example.com下载该包

2. 将shell脚本复制到您的主目录
3. 执行shell脚本

4. foobar系统将与认证系统通信

5. 一旦验证，foobar将引导一个名为“baz”的新数据库

6. 通过在命令行上执行SQL命令来测试“baz”

7. 类型:CREATE DATABASE my_foobar_db;

在上述步骤中，步骤4和步骤5发生在服务器端。目前还不清楚用户是否需要做什么，但他们不需要，所以这些副作用可以作为步骤3的一部分。同样，也不清楚第6步和第7步是否不同。(他们不是。)将所有原子用户操作合并为单个步骤，以便用户知道他们需要在流程的每个步骤中执行一些操作。此外，如果你的教程有用户可见的输入或输出，需要在单独的行上表示(通常使用等宽粗体字体)。

例子：优化一个糟糕的例子

1. 从我们的服务器http://example.com:下载该包

   $ curl -I http://example.com

2. 将shell脚本复制到你的主目录：

   $ cp foobar.sh ~

3. 在主目录下执行shell脚本:	

   $ cd ~;foobar系统将首先与身份验证系统通信。一旦验证，foobar将引导一个名为“baz”的新数据库，并打开一个输入shell。

4. 在命令行上执行SQL命令来测试“baz”:

   $ CREATE DATABASE my_foobar_db; 

注意每个步骤都需要特定的用户干预。如果教程侧重于其他方面(例如，关于“服务器生命周期”的文档)，那么就应该从该重点的角度(服务器做什么)为这些步骤编号。



#### 概念性文档

阅读有些代码需要比阅读参考文档有更深入的解释或见解。在这种情况下，我们需要概念文档来提供api或系统的概述。概念文档化的一些例子可能是一个流行API的库概述，一个描述服务器内数据生命周期的文档等等。几乎所有的情况下，一个概念性的文档都是用来增加，而不是取代一个参考文档集的。这常常导致某些资料的重复，但目的是：促进澄清。在这些情况下，概念文档不需要涵盖所有边缘情况(尽管参考文献应该涵盖这些情况)。在这种情况下，为了清晰度牺牲一些准确性是可以接受的。概念文件的主要目的是传授理解。

概念文档是最难编写的文档形式。因此，在软件工程师的工具箱里，它们往往是最被忽视的文档类型。工程师在编写概念性文档时面临的一个问题是，它通常不能直接嵌入到源代码中，因为没有一个规范的位置来放置它。一些API有一个相对广泛的API表面积，在这种情况下，一个文件注释可能是一个合适的地方来对API进行“概念性”的解释。但通常，一个API与其他API和/或模块规则一起工作。记录这种复杂行为的唯一合乎逻辑的地方是通过一个单独的概念性文档。如果注释是文档的单元测试，那么概念文档就是集成测试。

即使API有适当的作用域，提供一个单独的概念性文档也是有意义的。例如，Abseil的StrFormat库涵盖了API的成熟用户应该理解的各种概念。在这些情况下，我们在内部和外部都提供格式概念文档。

概念文档需要对广泛的受众有用:无论是专家还是新手。此外，它需要强调清晰度，所以经常需要牺牲完整性(最好的参考)和有时严格的准确性。这并不是说一个概念性文件应该故意不准确;这只是意味着它应该集中在常见用法上，而把罕见的用法或副作用留给参考文档。



#### 团队首页

大多数工程师是团队中的一员，并且大多数团队都有一个“团队页面”——在他们公司的内网。通常，这些网站有点混乱:一个典型的登录页面可能包含一些有趣的链接，有时几个标题为“先读这个!”，并为团队和客户提供一些信息。这些文件一开始很有用，但很快就变成了灾难;因为维护起来非常麻烦，它们最终会变得过时，只有勇敢或绝望的人才能修复它们。

幸运的是，这些文档看起来很吓人，但实际上很容易修复:确保登录页面清楚地表达其目的，然后只包含到其他页面的链接以获取更多信息。如果登陆页面上的某样东西做的不仅仅是警示，那它就没有做好它的工作。如果你有一个单独的设置文档，从登录页面作为一个单独的文档链接到它。如果登录页上有太多链接(您的页面不应该滚动多个屏幕)，考虑按分类将页面分成不同的部分。

大多数配置糟糕的登录页面都有两个不同的目的:它们是产品或API用户的“转到”页面，或者是团队的主页。不要让页面同时服务于两个主服务器——这会变得很混乱。创建一个独立的“团队页面”作为一个内部页面，除了主登陆页面。团队需要知道的通常与API的客户需要知道的是完全不同的。





